{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "vc",
  "title": "Battery-Ecosystem Verifiable Credential",
  "description": "Schema for verifying claims of a holder with verifier proof.",
  "type": "object",
  "required": ["@context", "id", "type", "issuer", "holder", "issuanceDate", "expirationDate", "credentialSubject", "proof"],
  "additionalProperties": false,
  "properties": {
    "@context": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uri",
        "enum": [
          "https://www.w3.org/2018/credentials/v1",
          "http://localhost:8443/docs/vc.schema.html"
        ]
      },
      "minItems": 2,
      "maxItems": 2,
      "uniqueItems": true,
      "description": "Defines the JSON-LD context, providing meaning to terms used in the credential."
    },
    "id": { "$ref": "common.defs.schema.json#/definitions/URI" },
    "type": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" },
      "contains": { "const": "VerifiableCredential" }
    },
    "issuer": { "$ref": "common.defs.schema.json#/definitions/DID" },
    "holder": { "$ref": "common.defs.schema.json#/definitions/DID" },
    "issuanceDate": { "$ref": "common.defs.schema.json#/definitions/DateTime" },
    "expirationDate": { "$ref": "common.defs.schema.json#/definitions/DateTime" },
    "credentialSubject": {
      "oneOf": [
        { "$ref": "#/definitions/BMSProduction" },
        { "$ref": "#/definitions/ServiceAccess" }
      ]
    },
    "proof": { "$ref": "common.defs.schema.json#/definitions/Proof" }
  },
  "definitions": {
    "BMSProduction": {
      "type": "object",
      "required": ["id", "type", "bmsDid", "timestamp", "lotNumber"],
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "common.defs.schema.json#/definitions/URI" },
        "type": { "const": "BMSProduction" },
        "bmsDid": { "$ref": "common.defs.schema.json#/definitions/DID" },
        "timestamp": { "type": "string", "format": "date" },
        "lotNumber": { "type": "string" }
      }
    },
    "ServiceAccess": {
      "type": "object",
      "required": ["id", "type", "bmsDid", "accessLevel", "validFrom", "validUntil"],
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "common.defs.schema.json#/definitions/URI" },
        "type": { "const": "ServiceAccess" },
        "bmsDid": { "$ref": "common.defs.schema.json#/definitions/DID" },
        "accessLevel": {
          "type": "array",
          "items": { "type": "string", "enum": ["read", "write"] }
        },
        "validFrom": { "$ref": "common.defs.schema.json#/definitions/DateTime" },
        "validUntil": { "$ref": "common.defs.schema.json#/definitions/DateTime" }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "credentialSubject": {
            "properties": { "type": { "const": "BMSProduction" } }
          }
        }
      },
      "then": {
        "properties": {
          "type": { "contains": { "const": "BMSProduction" } }
        }
      }
    },
    {
      "if": {
        "properties": {
          "credentialSubject": {
            "properties": { "type": { "const": "ServiceAccess" } }
          }
        }
      },
      "then": {
        "properties": {
          "type": { "contains": { "const": "ServiceAccess" } }
        }
      }
    }
  ]
}
